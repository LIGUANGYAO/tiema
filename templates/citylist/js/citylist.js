
/*___meta___touch/js/basic.981bb215.js*/
!function(){var a=function(){return this}(),b=document;!function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){for(d=a.target;!f.test(d.nodeName);)d=d.parentNode;"href"in d&&(chref=d.href).replace(e.href,"").indexOf("#")&&(!/^[a-z\+\.\-]+:/i.test(chref)||0===chref.indexOf(e.protocol+"//"+e.host))&&(a.preventDefault(),e.href=d.href)},!1)}}(b,a.navigator,"standalone");var c=a.MT||{};c.namespace=function(){var a,b,d,e=arguments,f=null;for(a=0;a<e.length;++a)for(d=e[a].split("."),f=c,b="MT"===d[0]?1:0;b<d.length;++b)f[d[b]]=f[d[b]]||{},f=f[d[b]];return f},c.TimeTracker=c.TimeTracker||{},c.namespace("touch"),c.touch={init:function(){var a=this;if(a.hideAddressBar(),a.lockForm(),a.guidePop(),a.checkWebp(),a.setUnloadTime(),-1===navigator.userAgent.indexOf("Android")){var b=document.querySelectorAll("input[type=number]");Array.prototype.slice.call(b,0).forEach(function(a){a.setAttribute("pattern","[0-9]*"),a.setAttribute("type","text")})}},sendGA:function(){var a=["_trackEvent"],b=[].slice.call(arguments);1===b.length?a.push("InnerLink","Click",b[0]):a=a.concat(b),_gaq.push(a)},hideAddressBar:function(){var d,e,f;c.BODY_SCROLL_TOP=!1,d=function(){var a=window,b=document;return a.pageYOffset||"CSS1Compat"===b.compatMode&&b.documentElement.scrollTop||b.body.scrollTop||0},e=function(){var a=window;location.hash||c.BODY_SCROLL_TOP===!1||a.scrollTo(0,1===c.BODY_SCROLL_TOP?0:1)},!location.hash&&a.addEventListener&&(window.scrollTo(0,1),c.BODY_SCROLL_TOP=1,f=setInterval(function(){b.body&&(clearInterval(f),c.BODY_SCROLL_TOP=d(),e())},15),document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){d()<20&&e()},0)}))},setUnloadTime:function(){a.addEventListener("unload",function(){c.Cookie.set("uldt",Date.now())}),b.body.addEventListener("click",function(){c.Cookie.set("uldt",Date.now())},!0)},lockForm:function(a){setTimeout(function(){var b=a?[document.getElementById(a)]:document.querySelectorAll("form[prevent-second-submit]");Array.prototype.slice.call(b).forEach(function(a){a.addEventListener("submit",function(){var b=Array.prototype.slice.call(a.querySelectorAll("input[type=submit], button"));b&&b.forEach(function(a){a.setAttribute("disabled","disabled")})})})},0)},unlockForm:function(a){var b=a?[document.getElementById(a)]:document.querySelectorAll("form[prevent-second-submit]");setTimeout(function(){Array.prototype.splice.call(b,0).forEach(function(a){var b=Array.prototype.splice.call(a.querySelectorAll("input[type=submit], button"),0);b&&b.forEach(function(a){a.setAttribute("disabled","")})})},0)},checkWebp:function(){a.addEventListener("load",function(){if(b.cookie&&c.Cookie.get("webp")){var a=new Image;a.onload=function(){if(2==a.height){var c=new Date;c.setDate(c.getDate()+365),b.cookie="webp=1; expires="+c.toGMTString()+"; domain= ; path=/"}},a.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}})},guidePop:function(){var a=document.getElementById("guide-close");a&&a.addEventListener("click",function(){var a=document.getElementById("mj_g_shadow"),b=document.getElementById("mj_g_pop");document.body.removeChild(a),document.body.removeChild(b)})}},c.Cookie={set:function(a,b,c){var d=new Date;d.setTime(d.getTime()+c),document.cookie=a+"="+encodeURIComponent(b)+";expires="+d.toGMTString()},get:function(a){var b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)"));return null!=b?decodeURIComponent(b[2]):null}},c.touch.init()}();
/*___meta___touch/js/base.js*/
var MT=window.MT||{};MT.namespace("util"),MT.namespace("widgets");var util=MT.util={isLocalStorageSupported:function(){try{return"localStorage"in window&&window.localStorage}catch(a){return!1}},uniq:function(a){var b,c,d=[],e={},f=a.length;if(2>f)return a;for(b=0;f>b;b++)c=a[b],1!==e[c]&&(d.push(c),e[c]=1);return d},errMsgFadeIn:function(a,b){var c=this;$("#okMsg").hide(),c.data("active")?c[a](b).animate("shake",500):c[a](b).fadeIn().data("active",!0),window.scrollTo(0,1),MT.touch.unlockForm()},okMsgFadeIn:function(a,b){var c=this;$("#errMsg").hide(),c[a](b).fadeIn().data("active",!0),window.scrollTo(0,1),MT.touch.unlockForm()},bindObjKeys:function(){var a=!0,b=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=Function.prototype.call.bind(Object.prototype.hasOwnProperty),d=b.length;for(var e in{toString:null})a=!1;Object.keys=function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on a non-object");var f=[];for(var g in e)c(e,g)&&f.push(g);if(a)for(var h=0,i=d;i>h;h++){var j=b[h];c(e,j)&&f.push(j)}return f}}};util.tapOrClick=MT.util.tapOrClick=function(){return"click"}();var widgets=MT.widgets.ItemsFactory=function(){function a(a,b){return this.opts=b,this.type=a,this}return $.extend(a,{bindItemTap:{city:function(b){var c=b.$itemsBox,d=c.find("li"),e="show-cate",f=b.maxItems||9;d.on(util.tapOrClick,function(c){c.preventDefault();var d=$(this),e=d.find("a"),g=e.attr("gaevent"),h=g.replace(b.gaeventPrefix,"@");return~e.text().indexOf("更多")||(h=e.text().replace(/\(\d+\)/,"")+h,a.setRecentItem2Storage(b.storageKey,f,h)),location.href=e.attr("href"),!1}),c.on(util.tapOrClick,".category-btn",function(){window.getSelection().removeAllRanges();var c=$(this);if(c.attr("class").indexOf("link")>0)return!0;var d=c.parent(),g=($("."+e),d.attr("class").indexOf(e)>-1),h=c.attr("class").indexOf("link")>-1;if(g)d.removeClass(e);else if(h){var i=c.data("name")+c.find("a").attr("gaevent").replace(b.gaeventPrefix,"@");a.setRecentItem2Storage(b.storageKey,f,i),location.href=c.find("a").attr("href")}else d.addClass(e)})},category:function(b){var c=b.$itemsBox,d=c.find("li"),e="show-cate",f=b.maxItems||9;d.on(util.tapOrClick,function(c){c.preventDefault();var d=$(this),e=d.find("a"),g=e.attr("gaevent"),h=g.replace(b.gaeventPrefix,"@");return d.data("more")?!1:(h=d.text().indexOf("全部")>-1?d.parents(".category-box").find(".category-btn").data("name")+h:e.text().replace(/\(\d+\)/,"")+h,a.setRecentItem2Storage(b.storageKey,f,h),location.href=e.attr("href"),!1)}),c.on(util.tapOrClick,".category-btn",function(c){if(c.preventDefault(),window.getSelection().removeAllRanges(),$(this).parent().attr("class").indexOf("hot-cate")>-1)return!1;var d=$(this),g=($("."+e),d.parent()),h=d.attr("class").indexOf("link")>-1,i=g.attr("class").indexOf(e)>-1;if(i)g.removeClass(e);else if(h){var j=d.data("name")+d.find("a").attr("gaevent").replace(b.gaeventPrefix,"@");a.setRecentItem2Storage(b.storageKey,f,j),location.href=d.find("a").attr("href")}else g.addClass(e)})}},buildRecentItemsList:{city:function(a){var b,c,d,e=a.$recentItemsBox,f=e.children("ul"),g="show-cate",h=localStorage.getItem(a.storageKey)||"";e.addClass(g),h=h.split(","),c=h.length,b=0===(c-1)%3?c-1-3:3*Math.floor((c-1)/3);for(var i=c-2;i>=0;i--){var j=h[i].split("@");d="",i>=b&&(d=" no-border-bottom"),0===(i+1)%3&&(d+=" no-border-right");var k="/"+j[1]+location.search,l=' data-recent="true"',m='gaevent="'+a.gaeventPrefix+j[1]+'"';h[i]=d?"<li"+l+'><a class="'+d+'" href="'+k+'" '+m+">"+j[0]+"</a></li>":"<li"+l+'><a href="'+k+'" '+m+">"+j[0]+"</a></li>"}f.html(h.slice(0,c-1).join("")),e.show()},category:function(a){var b,c,d,e=a.$recentItemsBox,f=e.children("ul"),g="show-cate",h=localStorage.getItem(a.storageKey)||"";e.addClass(g),h=h.split(","),c=h.length,b=0===(c-1)%3?c-1-3:3*Math.floor((c-1)/3);for(var i=c-2;i>=0;i--){var j=h[i].split("@");d="",i>=b&&(d=" no-border-bottom"),0===(i+1)%3&&(d+=" no-border-right");var k="/"+a.city+(location.search?location.search+"&type="+j[1]:"?type="+j[1]),l=' data-recent="true"',m='gaevent="'+a.gaeventPrefix+j[1]+'"';h[i]=d?"<li"+l+'><a class="'+d+'" href="'+k+'" '+m+">"+j[0]+"</a></li>":"<li"+l+'><a href="'+k+'" '+m+">"+j[0]+"</a></li>"}f.html(h.slice(0,c-1).join("")),e.show()}},setRecentItem2Storage:function(a,b,c){var d=localStorage.getItem(a)||"",e=d.split(","),f=-1;f=e.indexOf(c),f>-1&&e.splice(f,1),e.length>b&&e.pop(),e.unshift(c),e.length>1&&(d=e.join(","));try{localStorage.setItem(a,d)}catch(g){}}}),$.extend(a.prototype,{buildRecentItemsList:function(){if(util.isLocalStorageSupported()){var b=this,c=localStorage.getItem(b.opts.storageKey)||"";c.length<=0||a.buildRecentItemsList[b.type](b.opts)}},bindItemToggle:function(){var b=this;a.bindItemTap[b.type]||alert("~"),a.bindItemTap[b.type](b.opts)}}),a}();!function(a){a.extend(MT.touch||{},{goTop:function(){var b=a("body");b&&b.on(util.tapOrClick,"#nav-top",function(a){a.preventDefault(),window.scrollTo(0,0)})},tipsForLink:function(b,c){var d=a(b);d.on(util.tapOrClick,function(a){a.preventDefault();var b=window.confirm(c);b&&(window.location=d.data("href"))})},_changeForm2TenPay:function(b,c,d,e){if(b.length>0){var f='<input type="hidden" name="bank_type" value="'+e+'" />';b.replaceWith(a(f))}else c.val(e);d.val("tenpaywap")},_changeForm2AliPay:function(b,c,d,e){if(c.length>0){var f='<input type="hidden" name="cashierCode" value="'+e+'" />';c.replaceWith(a(f))}else b.val(e);d.val("alipaywap")},selectBank:function(b,c){var d=b.find("span"),e=this;d.on(util.tapOrClick,function(f){f.preventDefault(),d.css("background","#FFF"),a(this).css("background","#F1F1F1");var g=a(this),h=g.data("bankcode"),i=g.data("banktype"),j=b.find("input[name=paytype]"),k=b.find("input[name=cashierCode]"),l=b.find("input[name=bank_type]");"bank_type"===i?e._changeForm2TenPay(k,l,j,h):e._changeForm2AliPay(k,l,j,h),c?verifyAccount():b.submit()})},search:function(b,c){function d(a,b){var c=localStorage.getItem(a),d=c?c.split(","):[];d.unshift(b),d=util.uniq(d),d.length=d.length<6?d.length:6;try{localStorage.setItem(a,d.join(","))}catch(e){}}function e(){var b=localStorage.getItem(f),c=b?b.split(","):[],d=c.length;if(!(1>d)){var e="<h4>搜索历史</h4>";e+="<ul>",d=0==d%3?d:3*(Math.floor(d/3)+1);for(var g=0;d>g;g++){0==g%3&&(e+="<li>");var h,i;c[g]?(h=c[g].length>4?c[g].substring(0,4)+"…":c[g],i="/s"+(location.search?location.search+"&w="+c[g]:"?w="+c[g])):(h="",i="javascript:void(0)"),e+='<a href="'+i+'">'+h+"</a>",2==g%3&&(e+="</li>")}e+="</ul>",e+='<p id="clear-history" class="clear-history"><span>清除历史记录</span></p>',a("#search-history").html(e),a("#clear-history span").on(util.tapOrClick,function(b){b.preventDefault(),a("#search-history").hide(),localStorage.removeItem(f)})}}var f="search-histroy";e(),b.submit(function(b){var e=a.trim(a("#keyword").attr("value"));""===e||e===c?(b.preventDefault(),alert("请输入搜索关键词")):d(f,e)})},initQuantityBox:function(){a(".quantity-box").on(util.tapOrClick,function(b){b.preventDefault();var c=a(this),d=c.find(".minus"),e=c.find(".plus"),f=c.find("input"),g=f.attr("min")||0,h=f.attr("max")||Number.MAX_VALUE,i="DIV"==b.target.nodeName?b.target.className:b.target.parentNode.className,j=Number(f.val());return f.prop("disabled")?!1:(i.indexOf("minus")>-1?(j-1>=g&&f.val(j-1),j-1==g&&d.removeClass("active"),e.attr("class").indexOf("active")<0&&e.addClass("active")):i.indexOf("plus")>-1&&(h>=j+1&&f.val(j+1),j+1==h&&e.removeClass("active"),d.attr("class").indexOf("active")<0&&d.addClass("active")),f.trigger("change"),void 0)}).on("input","input",function(){var b=a(this),c=b.siblings(".minus"),d=b.siblings(".plus"),e=b.attr("min")||0,f=b.attr("max")||Number.MAX_VALUE,g=Number(b.val());e>g-1?(b.val(e),c.removeClass("active")):c.addClass("active"),f>g+1?d.addClass("active"):(b.val(f),d.removeClass("active"))})}}),MT.Cookie={set:function(a,b,c){var d=new Date;d.setTime(d.getTime()+c),document.cookie=a+"="+encodeURIComponent(b)+";expires="+d.toGMTString()},get:function(a){var b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)"));return null!=b?decodeURIComponent(b[2]):null}}}(Zepto),function(){MT.GEO={getLoc:function(a,b,c){function d(b){MT.touch.sendGA("Trace","Location","geolocationSuccess");var c=b.coords.latitude,d=b.coords.longitude,e=3e5;MT.Cookie.set("lat",c,e),MT.Cookie.set("lng",d,e),a(b)}function e(a){a.code===a.PERMISSION_DENIED?MT.touch.sendGA("Trace","Location","permissionDenied"):MT.touch.sendGA("Trace","Location","geolocationError"),"function"==typeof b&&b(a)}"geolocation"in navigator&&(c=c||{enableHightAccuracy:!1,timeout:1e4,maximumAge:0},navigator.geolocation.getCurrentPosition(d,e,c))},genURL:function(a,b){return"/locate/latlng/"+a+","+b+".json"},popChangeCity:function(a,b,c){MT.touch.sendGA("Trace","Location","popChangeCity");var d='<p style="text-align:center">检测到您目前所在城市是'+a+"<br>是否要切换</p>",e={okText:"切换",okGE:"imt/location/changeCity",cancelText:"取消",autoClose:!0},f={ok:b,cancel:c};MT.msg.confirm(d,f,e)}}}();
